<html lang="en">
<head>
        <meta charset="UTF-8" />
    <title>Phaser - Making your first game, part 9</title>
        <script type="text/javascript" src="js/phaser.min.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>

<script type="text/javascript">

var game = new Phaser.Game(1000, 600, Phaser.AUTO, '', { preload: preload, create: create, update: update, shootBullet:
shootBullet,  });



var GameState = function(game) {
};


function preload() {
     game.load.image('background', 'assets/szenen/bg_desert.png');
     game.load.image('cannon', 'assets/objects/canon/canon_base.png');
     game.load.image('canon_barrel', 'assets/objects/canon/canon_barrel.png');
     game.load.image('platform', 'assets/platform.png');
     game.load.image('star', 'assets/star.png');


}


function create() {

    game.physics.startSystem(Phaser.Physics.ARCADE);

    game.world.setBounds(0, 0, 1920, 600);


    bg = game.add.tileSprite(0, 0, 3840, 1000, 'background');



    this.GRAVITY = 500;
    game.physics.arcade.gravity.y = this.GRAVITY;

    this.gun = this.game.add.sprite(50, this.game.height - 100, 'cannon');
    this.gun.anchor.setTo(0.5,0.5);
    this.gun.scale.x = 0.25;
    this.gun.scale.y = 0.25;
    this.game.world.bringToTop(this.gun);
    
    this.gun2 = game.add.sprite(80, game.height - 110, 'canon_barrel');
    this.gun2.anchor.setTo(0.1, 0.5);
    this.gun2.scale.x = 0.25;
    this.gun2.scale.y = 0.25;


    groundBlock = this.game.add.sprite(0, this.game.height - 64, 'platform');
    groundBlock.scale.setTo(this.game.width, 2);
    this.game.physics.enable(groundBlock, Phaser.Physics.ARCADE);

    groundBlock.body.immovable = true;
    groundBlock.body.allowGravity = false;
    game.physics.arcade.enable(groundBlock);


    bullet = this.game.add.sprite(0.5, 0.5, 'star');

    this.NUMBER_OF_BULLETS = 1;
    bullet.anchor.setTo(0.5, 0.5);
    this.game.physics.enable(bullet, Phaser.Physics.ARCADE);
    bullet.body.collideWorldBounds = true;
    bullet.body.bounce.setTo(1, 1);
    bullet.kill();


}


function shootBullet() {
    bullet.reset(this.gun.x, this.gun.y);
    bullet.alive = true;
    bullet.checkWorldBounds = false;
    bullet.outOfBoundsKill = false;
    game.camera.follow(bullet);
    game.physics.arcade.moveToPointer(bullet, 800);
    game.debug.text("Distance to pointer: " + game.physics.arcade.distanceToPointer(bullet), 32, 32);


     game.camera.deadzone = new Phaser.Rectangle(150, 150, 500, 300);
    
    


}

function bodenBeruehren() {

        if (bullet.body.velocity.x >0){
        bullet.body.velocity.x -= 200;
        }
                 else{
                 bullet.kill();
                 }
        }
    
    

function update() {

    game.physics.arcade.collide(bullet, groundBlock, bodenBeruehren);




 this.game.world.bringToTop(this.gun);
    this.gun2.rotation = this.game.physics.arcade.angleToPointer(this.gun);

    if (this.game.input.activePointer.isDown) {
        this.shootBullet();
    }
    
     function generateBooster () {
    boosters = game.add.group();
    boosters.enableBody = true;
    var numBooster = game.rnd.integerInRange(0,5)
    var booster;
    
    for (var i = 0; i < numBooster; i++){
        var x = game.rnd.integerInRange(game.width, game.world.width - game.width);
        booster = boosters.create(x, game.height-75, 'star');
        booster.body.collideWorldBounds = false;
        booster.body.immovable = false;
    }
    
    

}
    
   


}

</script>

</body>
</html>